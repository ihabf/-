<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>Ù„Ø¹Ø¨Ø© Ø§Ù„Ø³Ø±Ø¹Ø© KelTa</title>
  <style>
    body { font-family: sans-serif; background: #111; color: #fff; text-align: center; padding: 20px; }
    #chat-box { border: 1px solid #555; background: #222; height: 300px; overflow-y: auto; padding: 10px; margin-top: 10px; }
    input, button { padding: 8px; margin: 5px; border-radius: 5px; border: none; font-size: 16px; }
    input { width: 70%; }
    button { background: #28a745; color: white; cursor: pointer; }
    button:hover { background: #1f7a33; }
    #login { margin-top: 50px; }
  </style>
</head>
<body>

  <div id="login">
    <h2>Ø£Ø¯Ø®Ù„ Ø§Ø³Ù…Ùƒ Ù„Ù„Ø§Ù†Ø¶Ù…Ø§Ù… ðŸŽ®</h2>
    <input id="nameInput" placeholder="Ø§Ø³Ù… Ø§Ù„Ù„Ø§Ø¹Ø¨" />
    <button id="joinBtn">Ø§Ù†Ø¶Ù…</button>
  </div>

  <div id="game" style="display:none;">
    <h2>Ù…Ø±Ø­Ø¨Ù‹Ø§ <span id="playerName"></span> ðŸ‘‹</h2>
    <div id="chat-box"></div>
    <input id="msgInput" placeholder="Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„Ø©..." />
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-app.js";
    import { getDatabase, ref, push, onChildAdded } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyDzGM7Zy6JIrFJyDj7s5SjAd-l8rbCe9VE",
      authDomain: "kelta-gmae.firebaseapp.com",
      databaseURL: "https://kelta-gmae-default-rtdb.firebaseio.com",
      projectId: "kelta-gmae",
      storageBucket: "kelta-gmae.firebasestorage.app",
      messagingSenderId: "247464874751",
      appId: "1:247464874751:web:779a3120e6b422fdee72ca",
      measurementId: "G-6C8HGRKLHS"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    const chatRef = ref(db, "chat");

    const loginDiv = document.getElementById("login");
    const gameDiv = document.getElementById("game");
    const nameInput = document.getElementById("nameInput");
    const joinBtn = document.getElementById("joinBtn");
    const msgInput = document.getElementById("msgInput");
    const chatBox = document.getElementById("chat-box");
    const playerName = document.getElementById("playerName");

    let username = "";
    let startTime = null;
    let expectedWords = [];

    joinBtn.onclick = () => {
      username = nameInput.value.trim();
      if (!username) return alert("Ø§ÙƒØªØ¨ Ø§Ø³Ù…Ùƒ Ø£ÙˆÙ„Ø§Ù‹!");
      playerName.textContent = username;
      loginDiv.style.display = "none";
      gameDiv.style.display = "block";
      msgInput.focus();
    };

    // Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Enter Ù„Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø³Ø§Ù„Ø©
    msgInput.addEventListener("keydown", (e) => {
      if (e.key === "Enter") {
        const text = msgInput.value.trim();
        if (!text) return;

        push(chatRef, { user: username, text, time: Date.now() });

        // Ø¥Ø°Ø§ ÙƒØªØ¨ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… "Ø·Ø´"
        if (text === "Ø·Ø´") {
          expectedWords = generateWords();
          push(chatRef, { user: "ðŸ¤– Ø§Ù„Ø¨ÙˆØª", text: expectedWords.join(" "), time: Date.now() });
          startTime = Date.now();
        }

        // ØªØ­Ù‚Ù‚ Ù…Ù† ÙƒØªØ§Ø¨Ø© ÙƒÙ„ Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ø§Ù„ØµØ­ÙŠØ­Ø©
        if (expectedWords.length && text === expectedWords.join(" ")) {
          const elapsed = (Date.now() - startTime) / 1000;
          const wpm = Math.round((expectedWords.length / elapsed) * 60);
          push(chatRef, { user: "ðŸ¤– Ø§Ù„Ø¨ÙˆØª", text: `Ø³Ø±Ø¹ØªÙƒ ${wpm} ÙƒÙ„Ù…Ø©/Ø¯Ù‚ÙŠÙ‚Ø© âš¡`, time: Date.now() });
          expectedWords = [];
        }

        msgInput.value = "";
      }
    });

    // Ø¯Ø§Ù„Ø© ØªÙˆÙ„ÙŠØ¯ 7 ÙƒÙ„Ù…Ø§Øª Ø¹Ø´ÙˆØ§Ø¦ÙŠØ©
    function generateWords() {
      const words = ["ØªÙØ§Ø­Ø©", "Ù…ÙˆØ²", "Ø³ÙŠØ§Ø±Ø©", "Ù‚Ù„Ù…", "Ø¨ÙŠØª", "Ø´Ù…Ø³", "ÙƒØ±Ø©", "ÙƒØªØ§Ø¨", "ÙƒÙ„Ø¨", "ÙˆØ±Ø¯Ø©", "Ø³ÙŠÙ", "Ø´Ø¬Ø±Ø©"];
      return Array.from({ length: 7 }, () => words[Math.floor(Math.random() * words.length)]);
    }

    // Ø¹Ø±Ø¶ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© ÙÙˆØ± ÙˆØµÙˆÙ„Ù‡Ø§
    onChildAdded(chatRef, (snapshot) => {
      const msg = snapshot.val();
      const div = document.createElement("div");
      div.textContent = `${msg.user}: ${msg.text}`;
      chatBox.appendChild(div);
      chatBox.scrollTop = chatBox.scrollHeight;
    });
  </script>
</body>
</html>
