<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>👋 مرحبًا بك في الدردشة</title>
<style>
body { font-family: "Cairo", sans-serif; background:#0e0e0e; color:#eee; display:flex; flex-direction:column; justify-content:center; align-items:center; height:100vh; margin:0; }
h1 { color:#ffd166; margin-bottom:20px; text-align:center; }
input { padding:10px; border-radius:6px; border:none; outline:none; width:250px; margin-bottom:10px; }
button { padding:10px 20px; border:none; border-radius:6px; background:#06d6a0; color:#000; font-weight:bold; cursor:pointer; }
p { color:#aaa; max-width:300px; text-align:center; }
</style>
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-app.js";
import { getDatabase, ref, get } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-database.js";

// 🔹 إعداد Firebase
const firebaseConfig = {
  apiKey: "AIzaSyDzGM7Zy6JIrFJyDj7s5SjAd-l8rbCe9VE",
  authDomain: "kelta-gmae.firebaseapp.com",
  databaseURL: "https://kelta-gmae-default-rtdb.firebaseio.com",
  projectId: "kelta-gmae",
  storageBucket: "kelta-gmae.firebasestorage.app",
  messagingSenderId: "247464874751",
  appId: "1:247464874751:web:779a3120e6b422fdee72ca",
  measurementId: "G-6C8HGRKLHS"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);
const usersRef = ref(db, "users");

// 🔹 اختيار الاسم والتحقق من التكرار
async function isNameTaken(name) {
  const snap = await get(usersRef);
  const users = snap.val() || {};
  return Object.values(users).some(u => u.name === name);
}

document.addEventListener("DOMContentLoaded", () => {
  const input = document.getElementById("nameInput");
  const btn = document.getElementById("enterBtn");

  btn.addEventListener("click", async () => {
    let username = input.value.trim() || "مجهول";

    if (await isNameTaken(username)) {
      alert("❌ هذا الاسم مستخدم بالفعل! اختر اسمًا آخر.");
      return;
    }

    localStorage.setItem("chat_username", username);
    window.location.href = "chat.html"; // الانتقال لصفحة الدردشة
  });
});
</script>
</head>
<body>
<h1>👋 مرحبًا بك في دردشة مؤقتة</h1>
<p>اكتب اسمك لتدخل الغرفة. يمكنك تغييره في أي وقت قبل الدخول.</p>
<input type="text" id="nameInput" placeholder="اكتب اسمك هنا..." />
<button id="enterBtn">دخول الغرفة</button>
</body>
</html>
